<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Heart Flame FINAL PRO</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#fff;
  overscroll-behavior:none;
}

.wrapper{
  position:relative;
  width:90vw;
  max-width:420px;
  aspect-ratio:420/380;
}

svg,canvas{
  position:absolute;
  inset:0;
}

.heart{
  fill:#ff0000;
  transform-origin:center;
  animation:beat 1.15s infinite;
}

@keyframes beat{
  0%{transform:scale(1)}
  25%{transform:scale(1.07)}
  55%{transform:scale(1)}
  100%{transform:scale(1)}
}

.center{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:120px;
  height:120px;
  background:#fff;
  border-radius:50%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:5;
  text-align:center;
}

.center .days{
  color:red;
  font-weight:700;
  font-size:22px;
}

.center .time{
  color:red;
  font-size:16px;
  margin-top:4px;
}

.center .label{
  font-size:11px;
  color:#666;
  margin-top:2px;
}
</style>
</head>

<body>

<div class="wrapper">

<svg viewBox="0 0 420 380">
  <defs>
    <clipPath id="heartClip">
      <path id="heartPath"
        d="M210 360
           C 20 200, 60 40, 210 120
           C 360 40, 400 200, 210 360 Z"/>
    </clipPath>
  </defs>

  <path class="heart"
    d="M210 360
       C 20 200, 60 40, 210 120
       C 360 40, 400 200, 210 360 Z"/>
</svg>

<canvas id="fire"></canvas>

<div class="center">
  <div class="days" id="days"></div>
  <div class="time" id="time"></div>
  <div class="label">Giờ · Phút · Giây</div>
</div>

</div>

<script>
/* ===== TIME ===== */
const start=new Date("2024-08-17T00:00:00");
function tick(){
 let d=(Date.now()-start)/1000|0;
 const day=d/86400|0; d%=86400;
 const h=d/3600|0; d%=3600;
 const m=d/60|0; const s=d%60;
 days.textContent=day+" DAY";
 time.textContent=
  `${h.toString().padStart(2,0)}:${m.toString().padStart(2,0)}:${s.toString().padStart(2,0)}`;
}
setInterval(tick,1000); tick();

/* ===== CANVAS FIX iPHONE ===== */
const canvas=document.getElementById("fire");
const wrapper=document.querySelector(".wrapper");
const ctx=canvas.getContext("2d");

function resize(){
 const r=wrapper.getBoundingClientRect();
 const dpr=window.devicePixelRatio||1;
 canvas.width=r.width*dpr;
 canvas.height=r.height*dpr;
 canvas.style.width=r.width+"px";
 canvas.style.height=r.height+"px";
 ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize",resize);
resize();

/* ===== FLAME ENGINE PRO ===== */
ctx.globalCompositeOperation="lighter";

const path=new Path2D(
 document.getElementById("heartPath").getAttribute("d")
);

function flame(x,y,h,wind){
 ctx.beginPath();
 ctx.moveTo(x,y);
 for(let i=0;i<h;i+=5){
  ctx.lineTo(
   x+Math.sin(i/18+performance.now()/600)*wind,
   y-i
  );
 }
 ctx.lineTo(x+3,y);
 ctx.closePath();

 const g=ctx.createLinearGradient(0,y,0,y-h);
 g.addColorStop(0,"rgba(255,255,220,.9)");
 g.addColorStop(.4,"rgba(255,160,0,.7)");
 g.addColorStop(.7,"rgba(255,80,0,.45)");
 g.addColorStop(1,"rgba(255,0,0,0)");
 ctx.fillStyle=g;
 ctx.fill();
}

function animate(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.save();
 ctx.clip(path);

 const t=performance.now()/1000;
 const beat=1+Math.sin(t*2.2)*0.35;
 const wind=Math.sin(t*0.8)*12;

 const W=canvas.width/(window.devicePixelRatio||1);
 const H=canvas.height/(window.devicePixelRatio||1);
 const cx=W/2, cy=H/2;
 const r=Math.min(W,H)*0.43;

 for(let i=0;i<140;i++){
  const a=i/140*Math.PI*2;
  const x=cx+Math.cos(a)*r;
  const y=cy+Math.sin(a)*r;
  flame(x,y,42*beat,wind);
 }

 ctx.restore();
 requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
