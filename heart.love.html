<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Heart Fire FINAL PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#fff;
  overflow:hidden;
}

#wrap{
  position:relative;
  width:420px;
  height:380px;
}

canvas{
  position:absolute;
  inset:0;
  pointer-events:none;
}

#bg{z-index:1;}
#fire{z-index:2;}
#aura{z-index:3;mix-blend-mode:screen;pointer-events:none;}
#bubble{z-index:4;pointer-events:none;}

#center{
  position:absolute;
  inset:0;
  z-index:5;
  display:flex;
  align-items:center;
  justify-content:center;
}

#circle{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#fff;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  box-shadow:0 0 30px rgba(255,120,120,.5);
  cursor:pointer;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif;
  pointer-events:auto;
}

.day{
  font-size:20px;
  font-weight:bold;
  color:#ff004c;
  line-height:1;
}

.time{
  font-size:12px;
  color:#ff004c;
  margin-top:4px;
  line-height:1;
}

/* ===== POPUP ===== */
#overlay{
  position:absolute;
  inset:0;
  pointer-events:auto;
  z-index:20;
  display:none;
  justify-content:center;
  align-items:center;
  backdrop-filter:blur(6px);
  background:rgba(0,0,0,.25);
}

#popup{
  position:relative;
  padding:26px 22px;
  background:rgba(255,255,255,.95);
  border-radius:18px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.25);
  animation:pop .35s ease;
}

#popupText{
  font-size:16px;
  font-weight:bold;
  color:#00a651;
  line-height:1.5;
}

@keyframes pop{
  from{transform:scale(.7);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>
<!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Love Heart">

<!-- Icon -->
<link rel="apple-touch-icon" href="icon.png">


<body>

<div id="wrap">
  <canvas id="bg" width="420" height="380"></canvas>
  <canvas id="fire" width="420" height="380"></canvas>
  <canvas id="aura" width="420" height="380"></canvas>
  <canvas id="bubble"></canvas>

  <div id="center">
    <div id="circle">
      <div class="day" id="days">0 DAY</div>
      <div class="time" id="clock">00:00:00</div>
    </div>
  </div>

  <!-- POPUP -->
  <div id="overlay">
    <div id="popup">
      <canvas id="firework" width="260" height="200"
        style="position:absolute;inset:0;pointer-events:none"></canvas>
      <div id="popupText"></div>
    </div>
  </div>
</div>

<script>
/* ===== TIME COUNT ===== */
const startDate = new Date("2024-08-17T00:00:00");
function updateTime(){
  const now = new Date();
  let diff = Math.floor((now - startDate)/1000);
  const days = Math.floor(diff/86400);
  diff%=86400;
  const h=Math.floor(diff/3600);
  const m=Math.floor((diff%3600)/60);
  const s=diff%60;

  daysEl.textContent = days+" DAY";
  clock.textContent =
    `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
const daysEl=document.getElementById("days");
const clock=document.getElementById("clock");
setInterval(updateTime,1000); updateTime();

/* ===== FIRE HEART ===== */
const fire=document.getElementById("fire").getContext("2d");
function heartPath(ctx,x,y,s){
  ctx.beginPath();
  for(let t=0;t<=Math.PI*2;t+=0.02){
    const X=16*Math.pow(Math.sin(t),3);
    const Y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    ctx.lineTo(x+X*s,y-Y*s);
  }
  ctx.closePath();
}
function drawFire(t){
  fire.clearRect(0,0,420,380);
  const p=1+Math.sin(t*1.3)*0.04;
  heartPath(fire,210,190,8.5*p);
  const g=fire.createRadialGradient(210,200,40,210,200,160);
  g.addColorStop(0,"#ff3300");
  g.addColorStop(.5,"#ff9900");
  g.addColorStop(1,"rgba(255,200,0,.15)");
  fire.fillStyle=g;
  fire.shadowColor="orange";
  fire.shadowBlur=35;
  fire.fill();
}

/* ===== AURA ===== */
const aura=document.getElementById("aura").getContext("2d");
function drawAura(t){
  aura.clearRect(0,0,420,380);
  aura.save();
  aura.beginPath();
  aura.arc(210,190,65,0,Math.PI*2);
  aura.clip();
  const g=aura.createConicGradient(t/6,210,190);
  ["#ffd6e7","#ffe9cc","#eaffea","#e6f0ff","#f0e6ff","#ffd6e7"]
    .forEach((c,i)=>{
      const r=parseInt(c.slice(1,3),16);
      const g1=parseInt(c.slice(3,5),16);
      const b=parseInt(c.slice(5,7),16);
      g.addColorStop(i/5,`rgba(${r},${g1},${b},.35)`);
    });
  aura.fillStyle=g;
  aura.fillRect(120,100,180,180);
  aura.restore();
}

/* ===== TIKTOK HEARTS (FIX iOS) ===== */
const bubble=document.getElementById("bubble");
const btx=bubble.getContext("2d");
const DPR=Math.min(window.devicePixelRatio||1,2);
bubble.width=420*DPR;
bubble.height=380*DPR;
bubble.style.width="420px";
bubble.style.height="380px";
btx.scale(DPR,DPR);

const colors=["#ff4d6d","#ff006e","#c77dff","#ff9f1c","#ff7aa2"];
let hearts=[],lastTap=0;

function spawnHearts(x,y,count=30){
  for(let i=0;i<count;i++){
    hearts.push({
      x:x+(Math.random()-0.5)*60,
      y:y+(Math.random()-0.5)*60,
      vx:(Math.random()-0.5)*0.4,
      vy:Math.random()*5+5,
      size:Math.random()*20+20,
      life:1,
      rot:Math.random()*Math.PI,
      color:colors[Math.floor(Math.random()*colors.length)]
    });
  }
}
function drawHeart(ctx,x,y,s,r,color,a){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(r);
  ctx.scale(s,s);
  ctx.globalAlpha=a;
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(0,-1);
  ctx.bezierCurveTo(-1.4,-2.6,-3.2,0.8,0,3.2);
  ctx.bezierCurveTo(3.2,0.8,1.4,-2.6,0,-1);
  ctx.fill();
  ctx.restore();
}
function animateHearts(){
  btx.clearRect(0,0,420,380);
  hearts=hearts.filter(h=>h.life>0);
  hearts.forEach(h=>{
    h.y-=h.vy;
    h.x+=h.vx;
    h.life-=0.03;
    h.rot+=0.05;
    drawHeart(btx,h.x,h.y,h.size/10,h.rot,h.color,h.life);
  });
  requestAnimationFrame(animateHearts);
}
animateHearts();

wrap.addEventListener("click",e=>{
  const r=wrap.getBoundingClientRect();
  spawnHearts(e.clientX-r.left,e.clientY-r.top);
});
wrap.addEventListener("touchstart",e=>{
  const r=wrap.getBoundingClientRect();
  const t=e.touches[0];
  spawnHearts(t.clientX-r.left,t.clientY-r.top);
});

/* ===== POPUP + FIREWORK ===== */
const overlay=document.getElementById("overlay");
const popupText=document.getElementById("popupText");
const firework=document.getElementById("firework");
const ftx=firework.getContext("2d");
const circle=document.getElementById("circle");
let sparks=[],popupOpen=false;

circle.addEventListener("click",e=>{
  e.preventDefault();
  e.stopPropagation();
  popupOpen=true;
  overlay.style.display="flex";
  popupText.innerHTML=
    `MÌNH ĐÃ CHÍNH THỨC YÊU NHAU ĐƯỢC<br><b>${daysEl.textContent.replace(" DAY","")} ngày ${clock.textContent.split(":")[0]} giờ</b>`;
  sparks=[];
  for(let i=0;i<70;i++){
    sparks.push({
      x:130,y:100,
      vx:(Math.random()-0.5)*7,
      vy:(Math.random()-0.5)*7,
      life:1
    });
  }
  drawFirework();
});

overlay.addEventListener("click",()=>{
  popupOpen=false;
  overlay.style.display="none";
});

function drawFirework(){
  ftx.clearRect(0,0,260,200);
  sparks=sparks.filter(s=>s.life>0);
  sparks.forEach(s=>{
    s.x+=s.vx;
    s.y+=s.vy;
    s.life-=0.03;
    ftx.fillStyle=`rgba(0,200,120,${s.life})`;
    ftx.beginPath();
    ftx.arc(s.x,s.y,2,0,Math.PI*2);
    ftx.fill();
  });
  if(popupOpen) requestAnimationFrame(drawFirework);
}

/* ===== LOOP ===== */
function loop(){
  const t=performance.now()/1000;
  drawFire(t);
  drawAura(t);
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
